calculate_lower_house_composition = {

	#Calculate lower_house size
	set_variable = {
		name = lower_house_size_var
		value = 100
	}

	#Calculate pro-government MPs
	set_variable = {
		name = pro_government_MPs_var
		value = 0
	}
	
	#1/3 of Upper House will always be pro-government if Legislature is appointed
	if = {
		limit = { has_law = law_type:law_technocratic_legislature }
		change_variable = { 
			name = lower_house_size_var
			add = 50
		}
		change_variable = {
			name = pro_government_MPs_var
			add = 50
		}
	}
	
	#Effect of voting laws
	if = {
		limit = { has_law = law_type:law_fair_voting }
		set_variable = { name = lower_house_threshold_var value = 1.0 }
	}
	if = {
		limit = { has_law = law_type:law_harassment_voting }
		set_variable = { name = lower_house_threshold_var value = 1.25 }
	}
	if = {
		limit = { has_law = law_type:law_gerrymandered_voting }
		set_variable = { name = lower_house_threshold_var value = 1.50 }
	}
	if = {
		limit = { has_law = law_type:law_rigged_voting }
		set_variable = { name = lower_house_threshold_var value = 2.0 }
	}
	if = {
		limit = { has_law = law_type:law_no_voting }
		set_variable = { name = lower_house_threshold_var value = 10 }
	}
	
	#Compute Parliament composition
	
	set_variable = { name = lower_house_010_var value = 0.1 }
	set_variable = { name = lower_house_020_var value = 0.2 }
	set_variable = { name = lower_house_030_var value = 0.3 }
	set_variable = { name = lower_house_040_var value = 0.4 }
	set_variable = { name = lower_house_050_var value = 0.5 }
	set_variable = { name = lower_house_060_var value = 0.6 }
	set_variable = { name = lower_house_070_var value = 0.7 }
	set_variable = { name = lower_house_080_var value = 0.8 }
	set_variable = { name = lower_house_090_var value = 0.9 }
	set_variable = { name = lower_house_100_var value = 1.0 }
	
	change_variable = { name = lower_house_010_var divide = root.var:lower_house_threshold_var }
	change_variable = { name = lower_house_020_var divide = root.var:lower_house_threshold_var }
	change_variable = { name = lower_house_030_var divide = root.var:lower_house_threshold_var }
	change_variable = { name = lower_house_040_var divide = root.var:lower_house_threshold_var }
	change_variable = { name = lower_house_050_var divide = root.var:lower_house_threshold_var }
	change_variable = { name = lower_house_060_var divide = root.var:lower_house_threshold_var }
	change_variable = { name = lower_house_070_var divide = root.var:lower_house_threshold_var }
	change_variable = { name = lower_house_080_var divide = root.var:lower_house_threshold_var }
	change_variable = { name = lower_house_090_var divide = root.var:lower_house_threshold_var }
	change_variable = { name = lower_house_100_var divide = root.var:lower_house_threshold_var }
	
	every_interest_group = {
		if = {
			limit = { is_in_government = yes ig_clout >= root.var:lower_house_010_var }
			owner = { 
				change_variable = {
					name = pro_government_MPs_var
					add = 10
				}
			}
		}
		if = {
			limit = { is_in_government = yes ig_clout >= root.var:lower_house_020_var }
			owner = { 
				change_variable = {
					name = pro_government_MPs_var
					add = 10
				}
			}
		}
		if = {
			limit = { is_in_government = yes ig_clout >= root.var:lower_house_030_var }
			owner = { 
				change_variable = {
					name = pro_government_MPs_var
					add = 10
				}
			}
		}
		if = {
			limit = { is_in_government = yes ig_clout >= root.var:lower_house_040_var }
			owner = { 
				change_variable = {
					name = pro_government_MPs_var
					add = 10
				}
			}
		}
		if = {
			limit = { is_in_government = yes ig_clout >= root.var:lower_house_050_var }
			owner = { 
				change_variable = {
					name = pro_government_MPs_var
					add = 10
				}
			}
		}
		if = {
			limit = { is_in_government = yes ig_clout >= root.var:lower_house_060_var }
			owner = { 
				change_variable = {
					name = pro_government_MPs_var
					add = 10
				}
			}
		}
		if = {
			limit = { is_in_government = yes ig_clout >= root.var:lower_house_070_var }
			owner = { 
				change_variable = {
					name = pro_government_MPs_var
					add = 10
				}
			}
		}
		if = {
			limit = { is_in_government = yes ig_clout >= root.var:lower_house_080_var }
			owner = { 
				change_variable = {
					name = pro_government_MPs_var
					add = 10
				}
			}
		}
		if = {
			limit = { is_in_government = yes ig_clout >= root.var:lower_house_090_var }
			owner = { 
				change_variable = {
					name = pro_government_MPs_var
					add = 10
				}
			}
		}
		if = {
			limit = { is_in_government = yes ig_clout >= root.var:lower_house_100_var }
			owner = { 
				change_variable = {
					name = pro_government_MPs_var
					add = 10
				}
			}
		}
	}
	
	#Bipartisan pacts
	if = {
		limit = { 
			root.var:pro_government_MPs_var < root.var:lower_house_size_var 
			has_variable = has_bipartisan_plan
		}
		every_interest_group = {
			limit = { 
				is_in_government = no
				is_marginal = no
				ig_approval > happy
				has_variable = bipartisan_participant
			}
			if = {
				limit = { ig_clout >= root.var:lower_house_010_var }
				owner = { 
					change_variable = {
						name = pro_government_MPs_var
						add = 10
					}
				}
			}
			if = {
				limit = { ig_clout >= root.var:lower_house_020_var }
				owner = { 
					change_variable = {
						name = pro_government_MPs_var
						add = 10
					}
				}
			}
			if = {
				limit = { ig_clout >= root.var:lower_house_030_var }
				owner = { 
					change_variable = {
						name = pro_government_MPs_var
						add = 10
					}
				}
			}
			if = {
				limit = { ig_clout >= root.var:lower_house_040_var }
				owner = { 
					change_variable = {
						name = pro_government_MPs_var
						add = 10
					}
				}
			}
			if = {
				limit = { ig_clout >= root.var:lower_house_050_var }
				owner = { 
					change_variable = {
						name = pro_government_MPs_var
						add = 10
					}
				}
			}
			if = {
				limit = { ig_clout >= root.var:lower_house_060_var }
				owner = { 
					change_variable = {
						name = pro_government_MPs_var
						add = 10
					}
				}
			}
			if = {
				limit = { ig_clout >= root.var:lower_house_070_var }
				owner = { 
					change_variable = {
						name = pro_government_MPs_var
						add = 10
					}
				}
			}
			if = {
				limit = { ig_clout >= root.var:lower_house_080_var }
				owner = { 
					change_variable = {
						name = pro_government_MPs_var
						add = 10
					}
				}
			}
			if = {
				limit = { ig_clout >= root.var:lower_house_090_var }
				owner = { 
					change_variable = {
						name = pro_government_MPs_var
						add = 10
					}
				}
			}
			if = {
				limit = { ig_clout >= root.var:lower_house_100_var }
				owner = { 
					change_variable = {
						name = pro_government_MPs_var
						add = 10
					}
				}
			}
		}
	}
	
	#Full House
	if = {
		limit = { root.var:pro_government_MPs_var > root.var:lower_house_size_var }
		set_variable = {
			name = pro_government_MPs_var
			value = root.var:lower_house_size_var
		}
	}
	
	#Determine if a simple majority exists
	set_variable = {
		name = lower_house_majority_var
		value = root.var:pro_government_MPs_var
	}
	if = {
		limit = { root.var:lower_house_majority_var > 0 }
		change_variable = {
			name = lower_house_majority_var
			divide = root.var:lower_house_size_var
		}
	}
	else = {
		set_variable = {
			name = lower_house_majority_var
			value = 0
		}
	}
	change_variable = {
		name = lower_house_majority_var
		multiply = 100
	}
	if = {
		limit = { root.var:lower_house_majority_var > 50 }
		set_variable = lower_house_has_simple_majority
	}
	if = {
		limit = { root.var:lower_house_majority_var > 66.7 }
		set_variable = lower_house_has_super_majority
	}
	if = {
		limit = { root.var:lower_house_majority_var < 50 }
		remove_variable = lower_house_has_simple_majority
		remove_variable = lower_house_has_super_majority
	}
	
	#For display only
	change_variable = { name = lower_house_010_var multiply = 100 }
	
	post_notification = lower_house_composition_updated

}